from django.http import HttpResponse
from django.template.loader import get_template
from rest_framework.permissions import AllowAny
from rest_framework.views import APIView
from xhtml2pdf import pisa

context = """
<div class="p-8 bg-white shadow-2xl border-2 rounded-lg md:w-[24cm] md:max-h-[29.7cm] w-full h-full"><div class="flex items-center"><img src="https://ui-avatars.com/api/?name=Avatar&amp;background=0D8ABC&amp;color=fff" alt="Profile" class="w-28 h-w-28 rounded-full"><div class="flex items-center justify-between w-full"><div class="ml-4"><h2 class="text-xl font-bold">Bell Byrd</h2><p class="text-gray-600">no title</p></div><div class="ml-4 text-end"><p class="text-sm py-0.5 text-gray-800">vyrojeqy@mailinator.com</p><p class="text-sm py-0.5 text-gray-800"></p><p class="text-sm py-0.5 text-gray-800"></p></div></div></div><hr class="my-6 border-2"><div class="grid grid-cols-2"><div><h3 class="text-lg font-bold">Summary</h3><p class="text-gray-600 text-sm"></p></div><div class="ml-4"><h3 class="text-lg font-bold mb-2">Skills</h3><div class="ml-4 space-y-1.5"><div class="flex items-center justify-between"><span>Flask</span><div class="flex space-x-3"><span class="w-5 h-5 rounded-full bg-blue-400"></span><span class="w-5 h-5 rounded-full bg-blue-400"></span><span class="w-5 h-5 rounded-full bg-gray-400"></span><span class="w-5 h-5 rounded-full bg-gray-400"></span><span class="w-5 h-5 rounded-full bg-gray-400"></span></div></div><div class="flex items-center justify-between"><span>Python</span><div class="flex space-x-3"><span class="w-5 h-5 rounded-full bg-blue-400"></span><span class="w-5 h-5 rounded-full bg-blue-400"></span><span class="w-5 h-5 rounded-full bg-blue-400"></span><span class="w-5 h-5 rounded-full bg-blue-400"></span><span class="w-5 h-5 rounded-full bg-gray-400"></span></div></div><div class="flex items-center justify-between"><span>Django 4</span><div class="flex space-x-3"><span class="w-5 h-5 rounded-full bg-blue-400"></span><span class="w-5 h-5 rounded-full bg-blue-400"></span><span class="w-5 h-5 rounded-full bg-blue-400"></span><span class="w-5 h-5 rounded-full bg-gray-400"></span><span class="w-5 h-5 rounded-full bg-gray-400"></span></div></div></div></div></div><hr class="my-6 border-2"><div class="grid grid-cols-2"><div><h3 class="text-lg font-bold">Experience</h3><div class="flex flex-col"><div class="ml-4 mt-4"><h4 class="text-md font-bold">Full Stack Developer</h4><p class="text-gray-600">Hellosss (Mar 2023 -- Mar 2023)</p><div class="ml-4">Description goes here</div></div></div></div><div class="ml-4"><h3 class="text-lg font-bold">Education</h3><div class="flex flex-col"><div class="ml-4 mt-4"><h4 class="text-md font-bold">BBA</h4><p class="text-gray-600">Lums (Mar 2016 -- Mar 2020)</p><span>3.4</span></div><div class="ml-4 mt-4"><h4 class="text-md font-bold">Matric</h4><p class="text-gray-600">MPS (Jan 2022 -- Apr 2023)</p><span>1002 / 1100 Marks</span></div><div class="ml-4 mt-4"><h4 class="text-md font-bold">Computer Science</h4><p class="text-gray-600">Superior University (Nov 2021 -- Apr 2023)</p><span>2.45 CGPA</span></div></div></div></div><hr class="my-6 border-2"><div class="grid grid-cols-2"><div class="flex flex-col space-y-1"><div><h3 class="text-lg font-bold">Hobbies</h3><div class="ml-4"><div class="inline-block"><span class="pr-2">swimming</span><span class="pr-2 text-gray-400 text-2xl">|</span></div><div class="inline-block"><span class="pr-2">crafting</span><span class="pr-2 text-gray-400 text-2xl">|</span></div><div class="inline-block"><span class="pr-2">hydi</span><span class="pr-2 text-gray-400 text-2xl"></span></div></div></div><div><h3 class="text-lg font-bold mt-4 mb-3">Social Links</h3><div class="ml-4"><div class="inline-block mr-6 opacity-60"><a href="https://www.other.com/" target="_blank" class="w-10 h-10" rel="noreferrer"><svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd"><path d="M22.994 8.7c-1.817-6.055-4.223-8.7-8.636-8.7-1.6 0-3.464.347-5.658 1.006-6.056 1.817-8.7 4.223-8.7 8.636 0 1.6.347 3.463 1.006 5.658 1.816 6.056 4.222 8.7 8.635 8.7 1.6 0 3.463-.347 5.659-1.006 6.055-1.817 8.7-4.222 8.7-8.635 0-1.6-.348-3.464-1.006-5.659m-4.164 5.353l-1.554.519.537 1.611c.211.652-.133 1.362-.786 1.573-.735.208-1.373-.206-1.574-.786l-.537-1.612-3.204 1.074.537 1.612c.212.653-.134 1.363-.786 1.573-.73.208-1.371-.201-1.573-.787l-.538-1.611-1.554.518c-.725.21-1.371-.203-1.574-.787-.21-.652.135-1.362.787-1.573l1.554-.518-1.036-3.089-1.554.518c-.729.207-1.37-.2-1.573-.787-.211-.652.134-1.362.786-1.573l1.555-.518-.538-1.611c-.211-.653.135-1.363.787-1.574.652-.211 1.362.134 1.573.787l.538 1.611 3.203-1.074-.536-1.612c-.212-.652.134-1.362.786-1.573.653-.211 1.363.134 1.574.787l.537 1.612 1.554-.519c.652-.211 1.362.135 1.573.787.212.652-.134 1.362-.786 1.573l-1.555.518 1.036 3.089 1.555-.518c.652-.211 1.362.134 1.573.787.211.652-.135 1.362-.787 1.573m-5.747-4.117l-3.202 1.073 1.035 3.092 3.202-1.072-1.035-3.093z"></path></svg></a></div><div class="inline-block mr-6 opacity-60"><a href="https://www.facebook.com/" target="_blank" class="w-10 h-10" rel="noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"></path></svg></a></div><div class="inline-block mr-6 opacity-60"><a href="https://www.linkedin.com/" target="_blank" class="w-10 h-10" rel="noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M4.98 3.5c0 1.381-1.11 2.5-2.48 2.5s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zm.02 4.5h-5v16h5v-16zm7.982 0h-4.968v16h4.969v-8.399c0-4.67 6.029-5.052 6.029 0v8.399h4.988v-10.131c0-7.88-8.922-7.593-11.018-3.714v-2.155z"></path></svg></a></div></div></div></div><div class="ml-4"><div><h3 class="text-lg font-bold mb-2">Languages</h3><div class="ml-4 space-y-2"><div class="flex items-center justify-between"><span>Spanish</span><div class="flex space-x-3"><span class="w-5 h-5 rounded-full bg-blue-400"></span><span class="w-5 h-5 rounded-full bg-gray-400"></span><span class="w-5 h-5 rounded-full bg-gray-400"></span><span class="w-5 h-5 rounded-full bg-gray-400"></span><span class="w-5 h-5 rounded-full bg-gray-400"></span></div></div><div class="flex items-center justify-between"><span>French</span><div class="flex space-x-3"><span class="w-5 h-5 rounded-full bg-blue-400"></span><span class="w-5 h-5 rounded-full bg-blue-400"></span><span class="w-5 h-5 rounded-full bg-blue-400"></span><span class="w-5 h-5 rounded-full bg-blue-400"></span><span class="w-5 h-5 rounded-full bg-blue-400"></span></div></div></div></div></div></div></div>
"""


class GenerateResume(APIView):
    permission_classes = (AllowAny,)

    def get(self, request):
        template = get_template("tailwind_template.html")
        html = template.render({"context": context})
        print(html)
        response = HttpResponse(content_type='application/pdf')
        response['Content-Disposition'] = f'attachment; filename="{request.data.get("name", "")} - cover.pdf"'
        pisa_status = pisa.CreatePDF(html, dest=response)
        return response
